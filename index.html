<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Welcome</title>
<link href="https://fonts.googleapis.com/css2?family=Nova+Mono&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Short+Stack&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="images/sitepic.png">
<style>

body {
    cursor: url('images/cursor.png'), auto;
}

button {
    cursor: url('images/click.png'), auto;
}
body {
    background-color: #FFFACD;
}
body {
    -webkit-tap-highlight-color: transparent;
}

body, .top-buttons, .image-container, .frame, .chat-room-frame {
    max-width: 90%;
    width: 100%;
    margin: 0;
    padding: 0;
}
body {
    font-family: 'Nova Mono', monospace;
    background-color: #fef9e7;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-image: linear-gradient(#f8ecc9 1px, transparent 1px),
                      linear-gradient(90deg, #f8ecc9 1px, #fef9e7 1px);
    background-size: 20px 20px;
}

.top-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}

.top-button {
    font-family: 'Short Stack', cursive;
    padding: 10px 15px;
    background-color: #fff9c4;
    color: #5D4037;
    border: 2px dashed #FFD580;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
}

.marquee {
    flex: 1;                
    overflow: hidden;
    white-space: nowrap;
    margin-bottom: 20px;
    position: relative;      
}

.marquee p {
    display: inline-block;
    padding-right: 100%;   
    animation: marquee 15s linear infinite;
    color: #5D4037;
    margin: 0;
    font-family: 'Short Stack', cursive;
}

@keyframes marquee {
    0%   { transform: translateX(100%); }  
    100% { transform: translateX(-100%); }  
}

.visitor-item.placeholder {
    justify-content: center;   
    font-style: italic;        
    color: #8B6B5C;            
}

.image-container {
    max-width: 600px;
    max-height: 400px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden; 
    border: 4px dashed #FFD580;
    border-radius: 12px;
    box-sizing: border-box;
    margin: 0 auto;
}

.image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none;
}

.buttons {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin: 10px 0 20px 0;
}
button {
    font-family: 'Short Stack', cursive;
    padding: 6px 12px;
    background-color: transparent;
    color: #5D4037;
    border: none;
    cursor: pointer;
    font-size: 16px;
}
button:hover, button.active {
    text-decoration: underline;
}

.frame {
    width: 600px;
    background-color: white;
    border: 4px dashed #FFD580;
    border-radius: 12px;
    box-sizing: border-box;
    margin: 20px auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-image: linear-gradient(to bottom, #f0f0f0 1px, transparent 1px);
    background-size: 100% 24px;
}

.frame-title {
    font-family: 'Short Stack', cursive;
    font-size: 24px;
    color: #FFD580;
    margin-bottom: 15px;
}

.stickers-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 15px;
}
.sticker { width: 50px; height: 50px; object-fit: contain; }
.sticker:nth-child(1) { animation: sway1 7s ease-in-out infinite; }
.sticker:nth-child(2) { animation: sway2 9s ease-in-out infinite; }
.sticker:nth-child(3) { animation: sway3 8s ease-in-out infinite; }
@keyframes sway1 { 0%,100%{transform:rotate(-5deg);}50%{transform:rotate(5deg);} }
@keyframes sway2 { 0%,100%{transform:rotate(4deg);}50%{transform:rotate(-4deg);} }
@keyframes sway3 { 0%,100%{transform:rotate(-6deg);}50%{transform:rotate(6deg);} }

.text-frame {
    background-color: #fff9c4; 
    border: 2px dashed #FFD580; 
    border-radius: 12px;
    padding: 20px;
    color: #5D4037;
    font-family: 'Short Stack', cursive;
    text-align: center;
    transition: color 0.3s ease;
}



.chat-room-content {
    display: none;
    width: 600px;
    text-align: center;
    margin: 0 auto;
}
.chat-room-content img {
    width: 100%;
    border-radius: 12px;
    margin-bottom: 20px;
    border: 4px dashed #FFD580;
}
.chat-room-frame {
    width: 600px;
    background-color: white;
    border: 4px dashed #FFD580;
    border-radius: 12px;
    padding: 20px;
    background-image: linear-gradient(to bottom, #f0f0f0 1px, transparent 1px);
    background-size: 100% 24px;
    margin: 0 auto;
    box-shadow: 0 0 10px rgba(0,0,0,0.05);
}

#chat {
    border: 2px solid #FFD580;
    padding: 15px;
    height: 300px;
    overflow-y: scroll;
    margin-bottom: 15px;
    background: white;
    text-align: left;
    border-radius: 12px;
    background-image: linear-gradient(to bottom, #f5f5f5 1px, transparent 1px);
    background-size: 100% 24px;
}

.input-group { display:flex; flex-direction: column; gap:10px; width:100%; }
#message { padding: 10px; border:2px solid #FFD580; border-radius:8px; font-family:'Short Stack',cursive; background:#fff9e0; outline: none; }
#sendBtn { padding:10px 15px; background:#fff9c4; color:#5D4037; border:2px dashed #FFD580; border-radius:8px; cursor:pointer; font-size:16px; margin-top:10px; }
#emojiBtn { padding:10px 15px; background:#fff9c4; color:#5D4037; border:2px dashed #FFD580; border-radius:8px; cursor:pointer; font-size:16px; }

.msg { margin-bottom:5px;}
.msg.me { background:#fff2cc; border-radius:8px; padding:2px 6px;}
.user { font-weight:bold; margin-right:5px;}
.time { font-size:0.8em; color:#8B6B5C; margin-right:5px;}
.typing-msg { font-style:italic; color:#8B6B5C; margin:5px 0;}

.buttons-row {
    display: flex;
    gap: 10px;
    justify-content: space-between;
    width: 100%;
}

.emoji-scroll-container {
    width: 600px;
    background-color: #fff9e0;
    border: 2px dashed #FFD580;
    border-radius: 8px;
    padding: 10px;
    margin-top: 10px;
    margin-left: -15px;
    overflow-x: auto;
    display: none;
    gap: 8px;
}

.emoji-item {
    width: 50px;
    height: 50px;
    object-fit: contain;
    cursor: pointer;
    transition: transform 0.2s;
    padding: 3px;
}
.emoji-item:hover {
    transform: scale(1.2);
}

.chat-notice {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
    font-family: 'Short Stack', cursive;
    color: #5D4037;
    background: white;
    padding: 10px;
    border-radius: 8px;
    border: 2px dashed #FFD580;
    background-image: linear-gradient(to bottom, #f5f5f5 1px, transparent 1px);
    background-size: 100% 24px;
}
.chat-notice img {
    width: 40px;
    height: 40px;
    animation: sway2 8s ease-in-out infinite;
    order: -1;
}
.rules-btn {
    background: none;
    border: none;
    color: #ff9800;
    cursor: pointer;
    font-family: 'Short Stack', cursive;
    font-size: inherit;
    padding: 0;
    margin-left: 5px;
    text-decoration: underline;
}
.rules-content {
    display: none;
    margin-top: 15px;
    padding: 15px;
    background: #fff9e0;
    border: 2px dashed #FFD580;
    border-radius: 8px;
    font-family: 'Short Stack', cursive;
    color: #5D4037;
    width: 600px;
}

.rules-content p {
    font-size: 14px;
    line-height: 1.5;
    margin: 0 0 10px 0;
}

.rules-content img {
    width: 100%;
    border-radius: 12px;
    margin-bottom: 20px;
    border: 4px dashed #FFD580;
}
.delete-text {
    font-size: 14px;
    line-height: 1.5;
    color: #e57373;
    font-weight: bold;
}

.home-container {
    display: flex;
    align-items: stretch;
    gap: 20px;
    max-width: 1240px;
    margin: 0 auto;
}

.visitor-box {
    flex: 0 0 250px;
    background-color: white;
    border: 4px dashed #FFD580;
    border-radius: 12px;
    padding: 20px;
    background-image: linear-gradient(to bottom, #f0f0f0 1px, transparent 1px);
    background-size: 100% 24px;
    display: flex;
    flex-direction: column;
}

.visitor-title {
    font-family: 'Short Stack', cursive;
    font-size: 24px;
    color: #FFD580;
    margin-bottom: 15px;
    text-align: center;
}

.visitor-list {
    list-style: none;
    padding: 0;
    margin: 40px 0 0 0; 
    flex-grow: 1;
    overflow-y: auto;
}

.visitor-item {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    font-family: 'Short Stack', cursive;
    color: #5D4037;
}

.visitor-img {
    width: 30px;
    height: 30px;
    margin-right: 10px;
    object-fit: contain;
}

.update-image {
width: 600px;
height: 300px;
max-width: 600px;
max-height: 300px;
 object-fit: contain;
 border: 2px dashed #FFD580;
}

.update-container {
    width: 600px;
    background-color: white;
    border: 4px dashed #FFD580;
    border-radius: 12px;
    box-sizing: border-box;
    margin: 20px auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-image: linear-gradient(to bottom, #f0f0f0 1px, transparent 1px);
    background-size: 100% 24px;
}

.update-text {
    font-family: 'Short Stack', cursive;
    color: #5D4037;
    text-align: center;
    line-height: 1.6;
}

.error-box {
    margin-top: 10px;
    padding: 8px 12px;
    border: 2px dashed #e57373;
    border-radius: 8px;
    background: #ffeaea;
    color: #b71c1c;
    font-family: 'Short Stack', cursive;
    font-size: 14px;
    text-align: center;
}

.about-content, .gallery-content, .games-content, .links-content {
    display: none;
    width: 600px;
    text-align: center;
    margin: 0 auto;
}

.about-content img, .gallery-content img, .games-content img, .links-content img {
    width: 100%;
    margin-bottom: 20px;
    border: 4px dashed #FFD580;
}

.gallery-container, .games-container, .links-container {
    width: 600px;
    background-color: white;
    border: 4px dashed #FFD580;
    border-radius: 12px;
    box-sizing: border-box;
    margin: 20px auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-image: linear-gradient(to bottom, #f0f0f0 1px, transparent 1px);
    background-size: 100% 24px;
}

.about-container {
    width: 600px;
    background-color: white;
    border: 4px dashed #FFD580; /* This border will now be on the outer container */
    border-radius: 12px;
    box-sizing: border-box;
    margin: 20px auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-image: linear-gradient(to bottom, #f0f0f0 1px, transparent 1px);
    background-size: 100% 24px;
}

.about-text {
    background-color: #fff9c4; 
    border: 2px dashed #FFD580; 
    border-radius: 12px;
    padding: 20px;
    color: #5D4037;
    font-family: 'Short Stack', cursive;
    text-align: center;
    transition: color 0.3s ease;
}


.gallery-text, .games-text, .links-text {
    font-family: 'Short Stack', cursive;
    color: #5D4037;
    text-align: center;
    line-height: 1.6;
}

.links-list {
    list-style: none;
    padding: 0;
    width: 100%;
}

.links-list li {
    margin-bottom: 15px;
}

.links-list a {
    font-family: 'Short Stack', cursive;
    color: #5D4037;
    text-decoration: none;
    font-size: 18px;
}

.links-list a:hover {
    text-decoration: underline;
}

.link-button {
    padding: 8px 15px;
    background-color: #ffb74d;
    color: #5D4037;
    border: 2px dashed #FFD580;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Short Stack', cursive;
    font-size: 16px;
    text-decoration: none;
    display: inline-block;
    margin: 5px;
}

.pinterest-button,
.link-button {
    background-color: transparent; 
    border: none;                 
    color: #ff9800;               
    font-family: 'Short Stack', cursive;
    font-size: 16px;
    text-decoration: underline;   
    cursor: pointer;
    padding: 0;                   
    margin: 5px;
}

.gallery-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin: 20px 0;
}

.gallery-item:hover {
    transform: scale(1.05);
}

.gallery-item img {
    width: 100%;
    height: auto;
    object-fit: contain;
    display: block;
}

.credits-section {
    margin: 30px 0;
    padding: 15px;
    background-color: #fff9c4;
    border: 2px dashed #FFD580;
    border-radius: 8px;
    text-align: center;
}

.credits-title {
    font-family: 'Short Stack', cursive;
    color: #5D4037;
    margin-bottom: 15px;
}

.asset-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 10px;
    margin: 20px 0;
}

.asset-item {
    border-radius: 8px;
    cursor: pointer;
}

.asset-item:hover {
    transform: scale(1.05);
}



.asset-item img {
    width: auto;
    height: 100px;      
    object-fit: contain;
    display: block;
    margin: 0 auto;     
}

.asset-type {
    font-family: 'Short Stack', cursive;
    color: #5D4037;
    margin-top: 30px;
    margin-bottom: 15px;
    text-align: center;
    font-size: 20px;
}

.banner-grid {
    display: flex;
    flex-direction: column;   
    align-items: center;      
    gap: 15px;                
}

.banner-grid .asset-item img {
    width: 100%;              
    height: auto;             
    object-fit: contain;     
}

@media(max-width:768px){#chat{height:200px;}}
</style>
</head>
<body>

<div class="top-buttons">
    <button class="top-button" onclick="showHome()">Home</button>
    <button class="top-button" onclick="showAbout()">About Me</button>
    <button class="top-button" onclick="showGallery()">Gallery</button>
    <button class="top-button" onclick="showGames()">Games</button>
    <button class="top-button" onclick="showChatRoom()">Chat Room</button>
    <button class="top-button" onclick="showLinks()">Links</button>
    <button class="top-button" onclick="showUpdate()">Update</button>
    <button class="top-button" onclick="toggleRules()">Rules</button>
</div>

<div id="home-content">
  <div class="home-container">

    <div class="visitor-box">
      <div class="visitor-title">Visitors Online</div>
<ul class="visitor-list" id="visitorList">
  <li class="visitor-item placeholder">- connecting -</li>
</ul>
    </div>

    <div>
      <div class="marquee"><p>Welcome to my little corner of the internet</p></div>

      <div class="image-container">
        <img src="images/image1.jpg" alt="Image 1">
        <img src="images/image2.jpg" alt="Image 2">
        <img src="images/image3.jpg" alt="Image 3">
      </div>

      <div class="buttons" style="justify-content: center;">
        <button onclick="showImage(0)" class="active">1</button>
        <button onclick="showImage(1)">2</button>
        <button onclick="showImage(2)">3</button>
      </div>

      <div class="frame">
        <div class="stickers-container">
          <img src="images/sticker1.png" class="sticker">
          <img src="images/sticker2.png" class="sticker">
          <img src="images/sticker3.png" class="sticker">
        </div>
        <div class="frame-title">- About -</div>
        <div class="text-frame">
          Hello! This is my personal site..<br>
          If you're wondering what happened to my previous one, I still have a copy of it.<br><br>
          I think I like cute, simple, aesthetic sites, so I put together this design just for fun because I love cute things! ! !
        </div>
      </div>
    </div>

  </div>
</div>

<div id="about-content" class="about-content">
    <img src="images/image5.jpg" alt="About Me">
    <div class="about-container">
        <div class="frame-title">- About -</div>
        <div class="about-text">
            I enjoy playing games, especially puzzles and problem solving games. I also like reading crime articles because I find them fascinating..<br><br>
            I'm a fan of cute things, and I like creating pixel art, drawing, and making animations.
        </div>
    </div>
</div>


<div id="gallery-content" class="gallery-content">
    <div class="gallery-container">
        <div class="gallery-text">
            <div class="credits-section">
                <p>All images shown here are sourced from Pinterest. I do not claim ownership of any of them.</p>
                <a href="https://www.pinterest.com/" target="_blank" class="pinterest-button">Pinterest</a>
            </div>
            
            <div class="gallery-grid">
                <div class="gallery-item"><img src="images/image1.jpg" alt="Gallery Image 1"></div>
                <div class="gallery-item"><img src="images/image2.jpg" alt="Gallery Image 2"></div>
                <div class="gallery-item"><img src="images/image3.jpg" alt="Gallery Image 3"></div>
                <div class="gallery-item"><img src="images/image4.jpg" alt="Gallery Image 4"></div>
                <div class="gallery-item"><img src="images/image5.jpg" alt="Gallery Image 5"></div>
            </div>
            
            <div class="asset-type">Banners</div>
<div class="asset-grid banner-grid">
    <div class="asset-item"><img src="images/banner.jpg" alt="Banner 1"></div>
    <div class="asset-item"><img src="images/banner2.jpg" alt="Banner 2"></div>
    <div class="asset-item"><img src="images/banner3.jpg" alt="Banner 3"></div>
</div>
            
            <div class="asset-type">Stickers</div>
            <div class="asset-grid">
                <div class="asset-item"><img src="images/sticker1.png" alt="Sticker 1"></div>
                <div class="asset-item"><img src="images/sticker2.png" alt="Sticker 2"></div>
                <div class="asset-item"><img src="images/sticker3.png" alt="Sticker 3"></div>
                <div class="asset-item"><img src="images/sticker4.png" alt="Sticker 4"></div>
            </div>
            
            <div class="asset-type">Emojis</div>
            <div class="asset-grid">
                <div class="asset-item"><img src="images/Emoji1.png" alt="Emoji 1"></div>
                <div class="asset-item"><img src="images/Emoji2.png" alt="Emoji 2"></div>
                <div class="asset-item"><img src="images/Emoji3.png" alt="Emoji 3"></div>
                <div class="asset-item"><img src="images/Emoji4.png" alt="Emoji 4"></div>
                <div class="asset-item"><img src="images/Emoji5.png" alt="Emoji 5"></div>
                <div class="asset-item"><img src="images/Emoji6.png" alt="Emoji 6"></div>
                <div class="asset-item"><img src="images/Emoji7.png" alt="Emoji 7"></div>
                <div class="asset-item"><img src="images/Emoji8.png" alt="Emoji 8"></div>
                <div class="asset-item"><img src="images/Emoji9.png" alt="Emoji 9"></div>
                <div class="asset-item"><img src="images/Emoji10.png" alt="Emoji 10"></div>
            </div>
        </div>
    </div>
</div>

<div id="games-content" class="games-content">
    <div class="games-container">
        <div class="games-text">
            Games content coming soon!
        </div>
    </div>
</div>
        
<div id="chat-room-content" class="chat-room-content">
    <img src="images/banner.jpg" alt="Chat Room Banner">
    <div class="chat-notice">
        <img src="images/sticker4.png" class="sticker">
        <div>The chat server may take a few seconds to connect. Thanks for your patience and don't forget to check the <button class="rules-btn" onclick="toggleRules()">Rules</button>!</div>
    </div>
    <div class="chat-room-frame">
        <div id="status" style="margin-bottom:10px;color:#5D4037;">Connecting...</div>
        <div id="chat"></div>
        <div class="input-group">
            <input id="message" placeholder="Type a message" maxlength="300">
            <div id="charCount" style="text-align:right;font-size:0.8em;color:#5D4037;">0/300</div>
            <div class="buttons-row">
                <button id="emojiBtn">Emoji</button>
                <button id="sendBtn">Send</button>
            </div>
         <div id="errorContainer"></div>
        </div>
    </div>
    <div class="emoji-scroll-container" id="emojiContainer">
        <img src="images/Emoji1.png" class="emoji-item" onclick="insertEmoji('Emoji1')">
        <img src="images/Emoji2.png" class="emoji-item" onclick="insertEmoji('Emoji2')">
        <img src="images/Emoji3.png" class="emoji-item" onclick="insertEmoji('Emoji3')">
        <img src="images/Emoji4.png" class="emoji-item" onclick="insertEmoji('Emoji4')">
        <img src="images/Emoji5.png" class="emoji-item" onclick="insertEmoji('Emoji5')">
        <img src="images/Emoji6.png" class="emoji-item" onclick="insertEmoji('Emoji6')">
        <img src="images/Emoji7.png" class="emoji-item" onclick="insertEmoji('Emoji7')">
        <img src="images/Emoji8.png" class="emoji-item" onclick="insertEmoji('Emoji8')">
        <img src="images/Emoji9.png" class="emoji-item" onclick="insertEmoji('Emoji9')">
        <img src="images/Emoji10.png" class="emoji-item" onclick="insertEmoji('Emoji10')">
    </div>
</div>

<div id="links-content" class="links-content">
    <img src="images/banner3.jpg" alt="Links Banner">
    <div class="links-container">
        <div class="links-text">
            <a href="https://neocities.org/" target="_blank" class="link-button">Neocities</a>
        </div>
    </div>
</div>

<div id="update-content" class="chat-room-content">
    <img src="images/image4.jpg" alt="Update Image" class="update-image">
    <div class="update-container">
        <div class="update-text">
            Version 1.0 – Initial Release<br>
            -Personal site launched<br>
            -Visitors can chat
        </div>
    </div>
</div>

<div id="rules-content" class="rules-content">
    <img src="images/banner2.jpg" alt="Rules Banner">
    <h3>Chat Room Rules</h3>
    <p>1. Be respectful to other users</p>
    <p>2. No spamming or flooding the chat</p>
    <p>3. No inappropriate content</p>
    <p>4. Keep conversations friendly and positive</p>
    <p>5. Have fun and enjoy chatting!</p>
    <h3>About the Chat Room</h3>
    <p>Sending and receiving messages can sometimes be slow, but don't worry they will show up eventually. Thank you for your patience!</p>
    <p>When you create a message, you won't be able to  <span class="delete-text">delete</span> it,</p>
 <p>only the admin can remove messages, but you can request deletion in the chat itself,</p> <p>and the admin will see it and remove the message, so be cautious about what you comment..</p>
 <h3>Chat Room Disconnected</h3>
  <p>If you get disconnected, refresh the page to reconnect.</p>
</div>

<script>
const images = document.querySelectorAll('.image-container img');
const buttons = document.querySelectorAll('.buttons button');
const homeContent = document.getElementById('home-content');
const aboutContent = document.getElementById('about-content');
const galleryContent = document.getElementById('gallery-content');
const gamesContent = document.getElementById('games-content');
const chatRoomContent = document.getElementById('chat-room-content');
const linksContent = document.getElementById('links-content');
const updateContent = document.getElementById('update-content');
const chatDiv = document.getElementById('chat');
const messageInput = document.getElementById('message');
const sendBtn = document.getElementById('sendBtn');
const statusDiv = document.getElementById('status');
const charCount = document.getElementById('charCount');
const emojiBtn = document.getElementById('emojiBtn');
const emojiContainer = document.getElementById('emojiContainer');
const rulesContent = document.getElementById('rules-content');
const visitorList = document.getElementById('visitorList');

let sessionToken = null;
let typingTimeout;
let emojiOpen = false;
let messagesInitialized = false;

function showImage(index) {
    images.forEach(img => img.style.display = 'none');
    images[index].style.display = 'block';
    buttons.forEach(btn => btn.classList.remove('active'));
    buttons[index].classList.add('active');
}
showImage(0);

function showHome() {
    homeContent.style.display = 'block';
    aboutContent.style.display = 'none';
    galleryContent.style.display = 'none';
    gamesContent.style.display = 'none';
    chatRoomContent.style.display = 'none';
    linksContent.style.display = 'none';
    updateContent.style.display = 'none';
    rulesContent.style.display = 'none';
}

function showAbout() {
    homeContent.style.display = 'none';
    aboutContent.style.display = 'block';
    galleryContent.style.display = 'none';
    gamesContent.style.display = 'none';
    chatRoomContent.style.display = 'none';
    linksContent.style.display = 'none';
    updateContent.style.display = 'none';
    rulesContent.style.display = 'none';
}

function showGallery() {
    homeContent.style.display = 'none';
    aboutContent.style.display = 'none';
    galleryContent.style.display = 'block';
    gamesContent.style.display = 'none';
    chatRoomContent.style.display = 'none';
    linksContent.style.display = 'none';
    updateContent.style.display = 'none';
    rulesContent.style.display = 'none';
}

function showGames() {
    homeContent.style.display = 'none';
    aboutContent.style.display = 'none';
    galleryContent.style.display = 'none';
    gamesContent.style.display = 'block';
    chatRoomContent.style.display = 'none';
    linksContent.style.display = 'none';
    updateContent.style.display = 'none';
    rulesContent.style.display = 'none';
}

function showChatRoom() {
    homeContent.style.display = 'none';
    aboutContent.style.display = 'none';
    galleryContent.style.display = 'none';
    gamesContent.style.display = 'none';
    chatRoomContent.style.display = 'block';
    linksContent.style.display = 'none';
    updateContent.style.display = 'none';
    rulesContent.style.display = 'none';
}

function showLinks() {
    homeContent.style.display = 'none';
    aboutContent.style.display = 'none';
    galleryContent.style.display = 'none';
    gamesContent.style.display = 'none';
    chatRoomContent.style.display = 'none';
    linksContent.style.display = 'block';
    updateContent.style.display = 'none';
    rulesContent.style.display = 'none';
}

function showUpdate() {
    homeContent.style.display = 'none';
    aboutContent.style.display = 'none';
    galleryContent.style.display = 'none';
    gamesContent.style.display = 'none';
    chatRoomContent.style.display = 'none';
    linksContent.style.display = 'none';
    updateContent.style.display = 'block';
    rulesContent.style.display = 'none';
}

function toggleRules() {
    rulesContent.style.display = 'block';
    homeContent.style.display = 'none';
    aboutContent.style.display = 'none';
    galleryContent.style.display = 'none';
    gamesContent.style.display = 'none';
    chatRoomContent.style.display = 'none';
    linksContent.style.display = 'none';
    updateContent.style.display = 'none';
}

function toggleEmoji() {
    if (emojiContainer.style.display === 'flex') {
        emojiContainer.style.display = 'none';
        emojiOpen = false;
    } else {
        emojiContainer.style.display = 'flex';
        emojiOpen = true;
    }
}

function insertEmoji(emojiName) {
    messageInput.value += `:${emojiName}:`;
    messageInput.focus();
}

function showErrorMessage(text) {
    const container = document.getElementById('errorContainer');
    const errorBox = document.createElement('div');
    errorBox.className = 'error-box';
    errorBox.textContent = `⚠ ${text}`;
    container.appendChild(errorBox);
    setTimeout(() => {
        errorBox.remove();
    }, 5000);
}

sendBtn.disabled = true;

const ws = new WebSocket("wss://chat-backend-1-dgp6.onrender.com");

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

ws.onopen = () => {
    console.log("Connected to chat backend!");
    statusDiv.textContent = "Connected!";
    if (!messagesInitialized) {
        chatDiv.innerHTML = '';
    }
};

ws.onclose = () => statusDiv.textContent = "Disconnected!";
ws.onerror = () => statusDiv.textContent = "Error connecting!";

ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    switch (data.type) {
        case 'session':
            sessionToken = data.token;
            sendBtn.disabled = false;
            sendBtn.textContent = "Send";
            if (data.defaultUser) {
                localStorage.setItem('chatUsername', data.defaultUser);
            }
            break;
        case 'init':
            if (!messagesInitialized) {
                data.messages.forEach(msg => {
                    addMessage(msg);
                });
                messagesInitialized = true;
            }
            break;
        case 'chat':
            addMessage(data);
            sendBtn.disabled = false;
            sendBtn.textContent = "Send";
            break;
        case 'clear':
            chatDiv.innerHTML = '';
            messagesInitialized = false;
            break;
        case 'delete':
            const msgDiv = [...chatDiv.children].find(d => d.dataset.id === data.id);
            if (msgDiv) msgDiv.remove();
            break;
        case 'typing':
            const oldTyping = document.querySelector(`.typing-msg[data-user="${data.user}"]`);
            if (oldTyping) oldTyping.remove();
            const typingEl = document.createElement('div');
            typingEl.className = 'typing-msg';
            typingEl.dataset.user = data.user;
            typingEl.textContent = `${data.user} is typing...`;
            chatDiv.appendChild(typingEl);
            chatDiv.scrollTo({ top: chatDiv.scrollHeight, behavior: 'smooth' });
            break;
        case 'stopTyping':
            const typingIndicator = document.querySelector(`.typing-msg[data-user="${data.user}"]`);
            if (typingIndicator) typingIndicator.remove();
            break;
        case 'userList':
            visitorList.innerHTML = '';
            data.users.forEach(user => {
                const li = document.createElement('li');
                li.className = 'visitor-item';
                li.innerHTML = `<img src="images/Visitor.png" class="visitor-img"> ${user}`;
                visitorList.appendChild(li);
            });
            break;  
        case 'error':
            showErrorMessage(data.message);
            sendBtn.disabled = false;    
            sendBtn.textContent = "Send";  
            break;
    }
};

function addMessage(msg) {
    const existingMsg = document.querySelector(`[data-id="${msg.id}"]`);
    if (existingMsg) return;
    
    const shouldScroll = chatDiv.scrollTop + chatDiv.clientHeight >= chatDiv.scrollHeight - 20;
    const div = document.createElement('div');
    div.classList.add('msg');
    let text = escapeHtml(msg.text);
    text = text.replace(/:Emoji(\d+):/g, '<img src="images/Emoji$1.png" style="width:30px;height:30px;vertical-align:middle;margin:0 2px;">');
    const username = escapeHtml(msg.user);
    const now = new Date();
    const timeStr = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
    div.innerHTML = `<span><span class="user">${username}</span> <span class="time">[${timeStr}]</span>: ${text}</span>`;
    div.dataset.id = msg.id;
    
    chatDiv.appendChild(div);
    if (shouldScroll) chatDiv.scrollTo({ top: chatDiv.scrollHeight, behavior: 'smooth' });
}

function sendMessage() {
    const username = localStorage.getItem('chatUsername');
    const text = messageInput.value.trim();
    if (!text || !sessionToken || text.length > 300) return;
    sendBtn.disabled = true;
    sendBtn.textContent = "Sending…";
    ws.send(JSON.stringify({ type: 'chat', user: username, text, token: sessionToken }));
    messageInput.value = '';
    charCount.textContent = "0/300";
    messageInput.focus();
    ws.send(JSON.stringify({ type: 'stopTyping', user: username }));
}

messageInput.addEventListener('input', () => {
    const username = localStorage.getItem('chatUsername');
    charCount.textContent = `${messageInput.value.length}/300`;
    ws.send(JSON.stringify({ type: 'typing', user: username }));
    clearTimeout(typingTimeout);
    typingTimeout = setTimeout(() => {
        ws.send(JSON.stringify({ type: 'stopTyping', user: username }));
    }, 1000);
});

sendBtn.addEventListener('click', sendMessage);
emojiBtn.addEventListener('click', toggleEmoji);
messageInput.addEventListener('keypress', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
    }
});

document.addEventListener('click', (e) => {
    if (emojiOpen && !emojiContainer.contains(e.target) && e.target !== emojiBtn) {
        return;
    }
});
</script>
</body>
</html>